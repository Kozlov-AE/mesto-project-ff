(()=>{"use strict";function e(e,t,n,r,o,i,u){var a=e.querySelector(".card").cloneNode(!0),c=a.querySelector(".card__delete-button"),l=a.querySelector(".card__like-button"),s=a.querySelector(".card__like-counter"),f=a.querySelector(".card__like-button");a.querySelector(".card__title").textContent=t.name;var d=a.querySelector(".card__image");return d.src=t.link,d.alt=t.name,s.textContent=t.likes.length,t.owner._id!=i?c.classList.add("card__delete-button--disabled"):c.addEventListener("click",(function(){n(a,t._id)})),d.addEventListener("click",(function(){return r(t.link,t.alt,t.name)})),t.likes.some((function(e){return e._id===i}))&&f.classList.add("card__like-button_is-active"),l.addEventListener("click",(function(){return o(a,t._id,u)})),a}function t(e,t,n){var r=e.querySelector(".card__like-counter"),o=e.querySelector(".card__like-button");o.classList.contains("card__like-button_is-active")?n.unlikeCard(t).then((function(e){null!=e&&(o.classList.remove("card__like-button_is-active"),r.textContent=e.likes.length)})):n.likeCard(t).then((function(e){null!=e&&(o.classList.add("card__like-button_is-active"),r.textContent=e.likes.length)}))}var n;function r(e){n=function(t){!function(e,t){console.log(e),"Escape"===e.key&&o(t)}(t,e)},document.addEventListener("keydown",n),e.classList.add("popup_is-opened")}function o(e){document.removeEventListener("keydown",n),e.classList.remove("popup_is-opened")}function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,c(r.key),r)}}function a(e,t,n){return(t=c(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e){var t=function(e){if("object"!=i(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==i(t)?t:t+""}var l=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),a(this,"formSelector",void 0),a(this,"inputSelector",void 0),a(this,"submitButtonSelector",void 0),a(this,"inactiveButtonClass",void 0),a(this,"inputErrorClass",void 0),a(this,"errorClass",void 0),this.formSelector=t.formSelector,this.inputSelector=t.inputSelector,this.submitButtonSelector=t.submitButtonSelector,this.inactiveButtonClass=t.inactiveButtonClass,this.inputErrorClass=t.inputErrorClass,this.errorClass=t.errorClass},(t=[{key:"subscribeForms",value:function(){var e=this;document.querySelectorAll(this.formSelector).forEach((function(t){var n=t.querySelector(e.submitButtonSelector),r=Array.from(t.querySelectorAll(e.inputSelector));r.forEach((function(t){e.subscribeInputElement(t,e.textInputValidation.bind(e),r,n)}))}))}},{key:"textInputValidation",value:function(e,t,n){console.info("Input validation: "+e),e.validity.valid?(this.hideError(e),t.every((function(e){return e.validity.valid}))&&this.setButtonOn(n)):(this.setButtonOff(n),e.validity.patternMismatch&&e.setCustomValidity(e.dataset.errorMessage),this.showError(e,e.validationMessage),e.setCustomValidity(""))}},{key:"showError",value:function(e,t){var n=this.getErrorElement(e);n.textContent=t,n.classList.add(this.errorClass)}},{key:"hideError",value:function(e){var t=this.getErrorElement(e);t.classList.remove(this.errorClass),t.textContent=""}},{key:"setButtonOff",value:function(e){e.classList.add(this.inactiveButtonClass),e.setAttribute("disabled",!0)}},{key:"setButtonOn",value:function(e){e.classList.remove(this.inactiveButtonClass),e.removeAttribute("disabled")}},{key:"subscribeInputElement",value:function(e,t,n,r){e.addEventListener("input",(function(){t(e,n,r)}))}},{key:"getErrorElement",value:function(e){return document.querySelector(".".concat(e.id,"-error"))}},{key:"clearErrors",value:function(e){var t=this;e.reset(),e.querySelectorAll(this.inputSelector).forEach((function(e){t.hideError(e)})),this.setButtonOff(e.querySelector(".popup__button"))}}])&&u(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,p(r.key),r)}}function d(e,t,n){return(t=p(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function p(e){var t=function(e){if("object"!=s(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=s(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==s(t)?t:t+""}var v=function(){return e=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),d(this,"baseUrl",void 0),d(this,"headers",void 0),d(this,"token",void 0),this.baseUrl=t,this.token=n,this.headers={authorization:n,"Content-Type":"application/json"}},(t=[{key:"get",value:function(e){var t=this;return fetch("".concat(this.baseUrl,"/").concat(e),{headers:this.headers}).then((function(e){return t.handleResponse(e)}))}},{key:"path",value:function(e,t){var n=this;return fetch("".concat(this.baseUrl,"/").concat(e),{method:"PATCH",headers:this.headers,body:JSON.stringify(t)}).then((function(e){return n.handleResponse(e)}))}},{key:"post",value:function(e,t){var n=this;return fetch("".concat(this.baseUrl,"/").concat(e),{method:"POST",headers:this.headers,body:JSON.stringify(t)}).then((function(e){return n.handleResponse(e)}))}},{key:"put",value:function(e){var t=this;return fetch("".concat(this.baseUrl,"/").concat(e),{method:"PUT",headers:{authorization:this.token}}).then((function(e){return t.handleResponse(e)}))}},{key:"delete",value:function(e){var t=this;return fetch("".concat(this.baseUrl,"/").concat(e),{method:"DELETE",headers:{authorization:this.token}}).then((function(e){return t.handleResponse(e)}))}},{key:"getProfile",value:function(){return this.get("users/me")}},{key:"updateProfile",value:function(e,t){return this.path("users/me",{name:e,about:t})}},{key:"addCard",value:function(e){return this.post("cards",e)}},{key:"getCards",value:function(){return this.get("cards")}},{key:"deleteCard",value:function(e){return this.delete("cards/".concat(e))}},{key:"likeCard",value:function(e){return this.put("cards/likes/".concat(e))}},{key:"unlikeCard",value:function(e){return this.delete("cards/likes/".concat(e))}},{key:"checkImageLink",value:function(e){return fetch(e,{method:"HEAD"}).then((function(e){if(e.ok){var t=e.headers.get("content-type");if(t&&t.includes("image"))return Promise.resolve(!0)}return Promise.reject()}))}},{key:"sendAvatar",value:function(e){return this.path("users/me/avatar",{avatar:e})}},{key:"handleResponse",value:function(e){return e.ok?e.json():Promise.reject("Ошибка отправки запроса: ".concat(e.status))}}])&&f(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function y(e,t){if(e){if("string"==typeof e)return h(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?h(e,t):void 0}}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var m,b=document.querySelector("#card-template").content,_=document.querySelector(".places__list"),k=document.querySelector(".profile__edit-button"),S=document.querySelector(".profile__image_edit-button"),g=document.querySelector(".profile__add-button"),E=document.querySelectorAll(".popup"),C=document.querySelector(".popup_type_edit"),q=document.forms["edit-profile"],w=document.querySelector(".popup_type_new-card"),L=document.forms["new-place"],P=document.querySelector(".popup_type_image"),j=P.querySelector(".popup__image"),x=P.querySelector(".popup__caption"),A=document.querySelector(".profile"),O=A.querySelector(".profile__title"),B=A.querySelector(".profile__description"),I=A.querySelector(".profile__image"),T=document.querySelector(".popup_type_edit-avatar"),U=document.forms["edit-avatar"],D=document.querySelector(".popup_type_confirm"),R=document.forms.submit,M="";function V(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Сохранение...",n=e.textContent;return e.textContent=t,n}k.addEventListener("click",(function(){return z.clearErrors(q),q.name.value=O.textContent,q.description.value=B.textContent,z.setButtonOn(q.querySelector("button")),void r(C)})),g.addEventListener("click",(function(){return r(w),void(L["place-name"].value&&L.link.value||z.clearErrors(L))})),S.addEventListener("click",(function(){return z.clearErrors(U),U.link.value=I.style.backgroundImage.slice(5,-2),void r(T)})),q.addEventListener("submit",(function(e){e.preventDefault();var t=e.target.querySelector(".button"),n=V(t);N.updateProfile(q.name.value,q.description.value).then((function(e){var r,i;O.textContent=null!==(r=e.name)&&void 0!==r?r:q.name.value,B.textContent=null!==(i=e.description)&&void 0!==i?i:q.description.value,V(t,n),o(C)})).catch((function(e){return console.error(e)})).finally((function(){V(t,n)}))})),L.addEventListener("submit",(function(n){n.preventDefault();var r=n.target.querySelector(".button"),i=V(r),u={name:L["place-name"].value,link:L.link.value};N.addCard(u).then((function(n){L.reset(),o(w);var r=e(b,n,H,F,t,M,N);_.prepend(r)})).catch((function(e){return console.error(e)})).finally((function(){return V(r,i)}))})),U.addEventListener("submit",(function(e){e.preventDefault();var t=e.target.querySelector(".button"),n=V(t);N.checkImageLink(U.link.value).then((function(){return N.sendAvatar(U.link.value)})).then((function(){I.style.backgroundImage="url(".concat(U.link.value,")"),o(T)})).catch((function(e){z.showError(U.link,e)})).finally((function(){V(t,n)}))})),R.addEventListener("submit",(function(e){e.preventDefault(),m(),o(D)}));var z=new l({formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error-show"}),N=new v("https://nomoreparties.co/v1/wff-cohort-21/","06e37664-dae8-425c-9b1a-fb1b9b710a57");function F(e,t,n){j.src=e,j.alt=t,x.textContent=n,r(P)}function H(e,t){r(D),m=function(){return function(e,t,n){n.deleteCard(t).then((function(t){null!=t&&e.remove()}))}(e,t,N)}}z.subscribeForms(),E.forEach((function(e){e.querySelector(".popup__close").addEventListener("click",(function(){return o(e)})),e.addEventListener("click",(function(t){t.target===e&&o(e)}))})),Promise.all([N.getProfile(),N.getCards()]).then((function(n){var r,o,i=(o=2,function(e){if(Array.isArray(e))return e}(r=n)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,u,a=[],c=!0,l=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(a.push(r.value),a.length!==t);c=!0);}catch(e){l=!0,o=e}finally{try{if(!c&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(l)throw o}}return a}}(r,o)||y(r,o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),u=i[0],a=i[1];O.textContent=u.name,B.textContent=u.about,I.style.backgroundImage="url(".concat(u.avatar,")"),M=u._id,function(e){var t,n=function(e){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=y(e))){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,u=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return i=e.done,e},e:function(e){u=!0,o=e},f:function(){try{i||null==t.return||t.return()}finally{if(u)throw o}}}}(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;_.append(r)}}catch(e){n.e(e)}finally{n.f()}}(a.map((function(n){return e(b,n,H,F,t,M,N)})))})).catch((function(e){return console.error(e)}))})();