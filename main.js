(()=>{"use strict";function t(t,e,n,r,o,i,c){var u=t.querySelector(".card").cloneNode(!0),a=u.querySelector(".card__delete-button"),l=u.querySelector(".card__like-button"),s=u.querySelector(".card__like-counter"),f=u.querySelector(".card__like-button");u.querySelector(".card__title").textContent=e.name;var d=u.querySelector(".card__image");return d.src=e.link,d.alt=e.name,s.textContent=e.likes.length,e.owner._id!=i?a.classList.add("card__delete-button--disabled"):a.addEventListener("click",(function(){n(u,e._id)})),d.addEventListener("click",(function(){return r(e.link,e.alt,e.name)})),e.likes.some((function(t){return t._id===i}))&&f.classList.add("card__like-button_is-active"),l.addEventListener("click",(function(){return o(u,e._id,c)})),u}function e(t,e,n){var r=t.querySelector(".card__like-counter"),o=t.querySelector(".card__like-button");o.classList.contains("card__like-button_is-active")?n.unlikeCard(e).then((function(t){null!=t&&(o.classList.remove("card__like-button_is-active"),r.textContent=t.likes.length)})):n.likeCard(e).then((function(t){null!=t&&(o.classList.add("card__like-button_is-active"),r.textContent=t.likes.length)}))}var n;function r(t){n=function(e){!function(t,e){console.log(t),"Escape"===t.key&&o(e)}(e,t)},document.addEventListener("keydown",n),t.classList.add("popup_is-opened")}function o(t){document.removeEventListener("keydown",n),t.classList.remove("popup_is-opened")}function i(t){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i(t)}function c(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,a(r.key),r)}}function u(t,e,n){return(e=a(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function a(t){var e=function(t){if("object"!=i(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==i(e)?e:e+""}var l=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),u(this,"formSelector",void 0),u(this,"inputSelector",void 0),u(this,"submitButtonSelector",void 0),u(this,"inactiveButtonClass",void 0),u(this,"inputErrorClass",void 0),u(this,"errorClass",void 0),this.formSelector=e.formSelector,this.inputSelector=e.inputSelector,this.submitButtonSelector=e.submitButtonSelector,this.inactiveButtonClass=e.inactiveButtonClass,this.inputErrorClass=e.inputErrorClass,this.errorClass=e.errorClass},(e=[{key:"subscribeForms",value:function(){var t=this;document.querySelectorAll(this.formSelector).forEach((function(e){var n=e.querySelector(t.submitButtonSelector),r=Array.from(e.querySelectorAll(t.inputSelector));r.forEach((function(e){t.subscribeInputElement(e,t.textInputValidation.bind(t),r,n)}))}))}},{key:"textInputValidation",value:function(t,e,n){console.info("Input validation: "+t),t.validity.valid?(this.hideError(t),e.every((function(t){return t.validity.valid}))&&this.setButtonOn(n)):(this.setButtonOff(n),t.validity.patternMismatch&&t.setCustomValidity(t.dataset.errorMessage),this.showError(t,t.validationMessage),t.setCustomValidity(""))}},{key:"showError",value:function(t,e){var n=this.getErrorElement(t);n.textContent=e,n.classList.add(this.errorClass)}},{key:"hideError",value:function(t){var e=this.getErrorElement(t);e.classList.remove(this.errorClass),e.textContent=""}},{key:"setButtonOff",value:function(t){t.classList.add(this.inactiveButtonClass)}},{key:"setButtonOn",value:function(t){t.classList.remove(this.inactiveButtonClass)}},{key:"subscribeInputElement",value:function(t,e,n,r){t.addEventListener("input",(function(){e(t,n,r)}))}},{key:"getErrorElement",value:function(t){return document.querySelector(".".concat(t.id,"-error"))}},{key:"clearErrors",value:function(t){var e=this;t.querySelectorAll(this.inputSelector).forEach((function(t){e.hideError(t)}))}}])&&c(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function s(t){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s(t)}function f(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,p(r.key),r)}}function d(t,e,n){return(e=p(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function p(t){var e=function(t){if("object"!=s(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=s(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==s(e)?e:e+""}var v=function(){return t=function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),d(this,"baseUrl",void 0),d(this,"headers",void 0),d(this,"token",void 0),this.baseUrl=e,this.token=n,this.headers={authorization:n,"Content-Type":"application/json"}},(e=[{key:"get",value:function(t){return fetch("".concat(this.baseUrl).concat(t),{headers:this.headers}).then((function(t){return t.ok?t.json():Promise.reject("Ответ сервера ".concat(t.status))})).catch((function(t){return console.error("Ошибка выполнения базового запроса GET: ".concat(t))}))}},{key:"path",value:function(t,e){return fetch("".concat(this.baseUrl).concat(t),{method:"PATCH",headers:this.headers,body:JSON.stringify(e)}).then((function(t){return console.info(t),t.ok?t.json():Promise.reject("Ответ сервера ".concat(t.status))})).catch((function(t){return console.error("Ошибка выполнения базового запроса PATCH: ".concat(t))}))}},{key:"post",value:function(t,e){return fetch("".concat(this.baseUrl).concat(t),{method:"POST",headers:this.headers,body:JSON.stringify(e)}).then((function(t){return t.ok?t.json():Promise.reject("Ответ сервера ".concat(t.status))})).catch((function(t){return console.error("Ошибка выполнения базового запроса POST: ".concat(t)),Promise.reject()}))}},{key:"delete",value:function(t){return fetch("".concat(this.baseUrl,"/").concat(t),{method:"DELETE",headers:{authorization:this.token}}).then((function(t){return t.ok?t.json():Promise.reject("Ответ сервера ".concat(t.status))})).catch((function(t){return console.error("Ошибка выполнения базового запроса DELETE: ".concat(t)),Promise.reject()}))}},{key:"deleteCard",value:function(t){return this.delete("cards/".concat(t))}},{key:"likeCard",value:function(t){return fetch("".concat(this.baseUrl,"cards/likes/").concat(t),{method:"PUT",headers:{authorization:this.token}}).then((function(t){return t.ok?t.json():(log.error("Ответ сервера ".concat(t.status)),Promise.reject())})).catch((function(t){return console.error("Ошибка выполнения likeCard: ".concat(t)),Promise.reject("Ошибка выполнения likeCard")}))}},{key:"unlikeCard",value:function(t){return this.delete("/cards/likes/".concat(t))}},{key:"checkImageLink",value:function(t){return fetch(t,{method:"HEAD"}).then((function(t){if(t.ok){var e=t.headers.get("content-type");if(e&&e.includes("image"))return Promise.resolve(!0)}return Promise.reject()})).catch((function(t){return console.log("Ошибка при проверке ссылки на изображение: ".concat(t)),Promise.reject("Ошибка при проверке ссылки на изображение")}))}},{key:"sendAvatar",value:function(t){var e={avatar:t};return fetch("".concat(this.baseUrl,"users/me/avatar"),{method:"PATCH",headers:this.headers,body:JSON.stringify(e)}).then((function(t){return t.ok?t.json():Promise.reject("Ответ сервера ".concat(t.status))})).catch((function(t){return console.error("Ошибка при отправке ссылки на аватар: ".concat(t)),Promise.reject("Ошибка сервера при отправке ссылки на аватар")}))}}])&&f(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var y,h=document.querySelector("#card-template").content,b=document.querySelector(".places__list"),_=document.querySelector(".profile__edit-button"),k=document.querySelector(".profile__image_edit-button"),S=document.querySelector(".profile__add-button"),E=document.querySelectorAll(".popup"),g=document.querySelector(".popup_type_edit"),C=document.forms["edit-profile"],q=document.querySelector(".popup_type_new-card"),j=document.forms["new-place"],w=document.querySelector(".popup_type_image"),L=w.querySelector(".popup__image"),P=w.querySelector(".popup__caption"),x=document.querySelector(".profile"),O=x.querySelector(".profile__title"),A=x.querySelector(".profile__description"),B=x.querySelector(".profile__image"),T=document.querySelector(".popup_type_edit-avatar"),I=document.forms["edit-avatar"],U=document.querySelector(".popup_type_confirm"),D=document.forms.submit,H="";function M(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Сохранение...",n=t.textContent;return t.textContent=e,n}_.addEventListener("click",(function(){return N.clearErrors(C),C.name.value=O.textContent,C.description.value=A.textContent,N.setButtonOn(C.querySelector("button")),void r(g)})),S.addEventListener("click",(function(){r(q)})),k.addEventListener("click",(function(){return I.link.value=B.style.backgroundImage.slice(5,-2),N.clearErrors(I),void r(T)})),C.addEventListener("submit",(function(t){t.preventDefault();var e=t.target.querySelector(".button"),n=M(e);V.path("users/me",{name:C.name.value,about:C.description.value}).then((function(t){var r,i;O.textContent=null!==(r=t.name)&&void 0!==r?r:C.name.value,A.textContent=null!==(i=t.description)&&void 0!==i?i:C.description.value,M(e,n),o(g)})).catch((function(t){return console.error(t)})).finally((function(){M(e,n)}))})),j.addEventListener("submit",(function(n){n.preventDefault();var r=n.target.querySelector(".button"),i=M(r),c={name:j["place-name"].value,link:j.link.value};V.post("cards",c).then((function(n){j.reset(),N.setButtonOff(j.querySelector("button")),o(q);var r=t(h,n,J,z,e,H,V);b.prepend(r)})).finally((function(){M(r,i)}))})),I.addEventListener("submit",(function(t){t.preventDefault();var e=t.target.querySelector(".button"),n=M(e);V.checkImageLink(I.link.value).then((function(){return V.sendAvatar(I.link.value)})).then((function(t){return F()})).then((function(){return o(T)})).catch((function(t){N.showError(I.link,t)})).finally((function(){M(e,n)}))})),D.addEventListener("submit",(function(t){t.preventDefault(),y(),o(U)}));var N=new l({formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error-show"}),V=new v("https://nomoreparties.co/v1/wff-cohort-21/","06e37664-dae8-425c-9b1a-fb1b9b710a57");function z(t,e,n){L.src=t,L.alt=e,P.textContent=n,r(w)}function J(t,e){r(U),y=function(){return function(t,e,n){n.deleteCard(e).then((function(e){null!=e&&t.remove()}))}(t,e,V)}}function F(){V.get("users/me").then((function(t){O.textContent=t.name,A.textContent=t.about,B.style.backgroundImage="url(".concat(t.avatar,")"),H=t._id}))}N.subscribeForms(),E.forEach((function(t){t.querySelector(".popup__close").addEventListener("click",(function(){return o(t)})),t.addEventListener("click",(function(e){e.target===t&&o(t)}))})),F(),V.get("cards").then((function(n){return n.map((function(n){return t(h,n,J,z,e,H,V)}))})).then((function(t){return function(t){var e,n=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return m(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?m(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,c=!0,u=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return c=t.done,t},e:function(t){u=!0,i=t},f:function(){try{c||null==n.return||n.return()}finally{if(u)throw i}}}}(t);try{for(n.s();!(e=n.n()).done;){var r=e.value;b.append(r)}}catch(t){n.e(t)}finally{n.f()}}(t)})).catch((function(t){return console.error(t)}))})();